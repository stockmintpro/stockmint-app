<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockMint - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Sidebar dan Navbar akan diload via common.js -->
    
    <!-- Main Content -->
    <div class="content" id="content-area">
        <div class="dashboard-header">
            <h1>Dashboard Overview</h1>
            <button class="btn btn-primary" id="refreshBtn">
                <i class="fas fa-sync-alt"></i> Refresh Data
            </button>
        </div>
        
        <div class="demo-banner" id="demoBanner" style="display: none;">
            <i class="fas fa-flask"></i>
            <div>
                <strong>Mode Demo Aktif</strong> - Anda sedang mencoba fitur StockMint dalam mode demo.
                Untuk akses penuh, login dengan akun Google.
            </div>
        </div>
        
        <div class="welcome-card">
            <h2>Selamat datang di <strong>StockMint</strong></h2>
            <p>Sistem pelacakan inventaris dan profit dengan presisi tinggi untuk bisnis Anda.</p>
        </div>
        
        <h2>Quick Stats</h2>
        <div class="stats-container">
            <div class="stat-card">
                <h3>Total Products</h3>
                <div class="stat-value" id="totalProducts">142</div>
                <div class="stat-change">↑ 12% from last month</div>
            </div>
            <div class="stat-card">
                <h3>Today's Sales</h3>
                <div class="stat-value" id="todaySales">Rp 3.250.000</div>
                <div class="stat-change">↑ 8% from yesterday</div>
            </div>
            <div class="stat-card">
                <h3>Low Stock Alert</h3>
                <div class="stat-value" id="lowStock">8 Items</div>
                <div class="stat-change danger">⚠️ Need restock</div>
            </div>
            <div class="stat-card">
                <h3>Monthly Profit</h3>
                <div class="stat-value" id="monthlyProfit">Rp 48.500.000</div>
                <div class="stat-change">↑ 15% from last month</div>
            </div>
        </div>
        
        <h2>Recent Activities</h2>
        <div class="recent-activities">
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="activity-content">
                    <strong>Product "Kopi Arabica Premium" added to inventory</strong>
                    <div class="activity-time">Today, 10:30 AM</div>
                </div>
            </div>
            
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="activity-content">
                    <strong>Sale completed - Rp 2.450.000</strong>
                    <div class="activity-time">2 hours ago</div>
                </div>
            </div>
            
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div class="activity-content">
                    <strong>Monthly report generated for October 2023</strong>
                    <div class="activity-time">2 days ago</div>
                </div>
            </div>
            
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-box"></i>
                </div>
                <div class="activity-content">
                    <strong>Low stock alert for "Teh Hijau"</strong>
                    <div class="activity-time">3 days ago</div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Cek autentikasi terlebih dahulu
            const token = localStorage.getItem('stockmint_token');
            const user = JSON.parse(localStorage.getItem('stockmint_user') || '{}');
            
            if (!token || !user.email) {
                window.location.href = 'index.html';
                return;
            }
            
            // Load common elements (sidebar & navbar)
            try {
                await loadCommonElements();
                
                // Set active menu untuk dashboard
                setTimeout(() => {
                    document.querySelectorAll('.menu-item').forEach(item => {
                        item.classList.remove('active');
                        if (item.getAttribute('href') === 'dashboard.html') {
                            item.classList.add('active');
                        }
                    });
                }, 300);
                
                // Show demo banner jika dalam mode demo
                if (user.isDemo) {
                    document.getElementById('demoBanner').style.display = 'flex';
                    // Load demo data
                    loadDemoData();
                } else {
                    loadRealData();
                }
                
                // Event listeners
                document.getElementById('refreshBtn').addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    const originalClass = icon.className;
                    
                    icon.className = 'fas fa-spinner loading';
                    this.disabled = true;
                    
                    setTimeout(() => {
                        icon.className = originalClass;
                        this.disabled = false;
                        
                        if (user.isDemo) {
                            loadDemoData();
                        } else {
                            loadRealData();
                        }
                        
                        // Tambah activity baru
                        const activities = document.querySelector('.recent-activities');
                        const newActivity = document.createElement('div');
                        newActivity.className = 'activity-item';
                        newActivity.innerHTML = `
                            <div class="activity-icon">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <div class="activity-content">
                                <strong>Dashboard data refreshed</strong>
                                <div class="activity-time">Just now</div>
                            </div>
                        `;
                        activities.insertBefore(newActivity, activities.firstChild);
                        
                        alert('Data diperbarui!');
                    }, 1000);
                });
                
            } catch (error) {
                console.error('Error initializing dashboard:', error);
                // Fallback jika gagal load common elements
                alert('Error loading page components. Please refresh the page.');
            }
        });
        
        function loadDemoData() {
            // Demo data
            document.getElementById('totalProducts').textContent = '142';
            document.getElementById('todaySales').textContent = 'Rp 3.250.000';
            document.getElementById('lowStock').textContent = '8 Items';
            document.getElementById('monthlyProfit').textContent = 'Rp 48.500.000';
        }
        
        function loadRealData() {
            // Load real data from localStorage
            const masterData = JSON.parse(localStorage.getItem('stockmint_master_data') || '{}');
            document.getElementById('totalProducts').textContent = (masterData.products?.length || 0);
            // Data lainnya bisa diisi dari localStorage atau API
        }
    </script>
</body>
</html>
