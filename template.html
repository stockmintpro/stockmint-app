<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockMint - Excel Template</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="https://i.ibb.co.com/XxvfRDyV/logo-stockmint-png.png">
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --mint-green: #19BEBB;
            --mint-dark: #0fa8a6;
            --text-light: #ffffff;
            --text-dark: #333333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, var(--mint-green) 0%, var(--mint-dark) 100%);
            color: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 12px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .header-content h1 {
            font-size: 32px;
            margin-bottom: 5px;
        }
        
        .header-content p {
            opacity: 0.9;
        }
        
        .main-content {
            background: white;
            padding: 30px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        
        .btn-primary {
            background-color: var(--mint-green);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--mint-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(25, 190, 187, 0.2);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-back {
            background-color: transparent;
            color: var(--mint-green);
            border: 2px solid var(--mint-green);
        }
        
        .btn-back:hover {
            background-color: var(--mint-green);
            color: white;
        }
        
        .template-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .option-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border-left: 5px solid var(--mint-green);
            transition: transform 0.3s ease;
        }
        
        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        
        .option-card h3 {
            color: var(--mint-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .option-card ul {
            padding-left: 20px;
            margin-bottom: 20px;
            color: #555;
        }
        
        .option-card li {
            margin-bottom: 8px;
        }
        
        .sheets-table {
            width: 100%;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            margin: 30px 0;
        }
        
        .sheets-table th {
            background-color: var(--mint-green);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .sheets-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .sheets-table tr:hover {
            background-color: #f0f9ff;
        }
        
        .sheet-tag {
            display: inline-block;
            background: var(--mint-green);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .preview-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            border-left: 4px solid var(--mint-green);
        }
        
        .preview-table {
            width: 100%;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .preview-table th {
            background: #e9ecef;
            padding: 10px;
            text-align: left;
            font-weight: 600;
        }
        
        .preview-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .instructions {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
        }
        
        .instructions h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .template-options {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .sheets-table {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="https://i.ibb.co.com/XxvfRDyV/logo-stockmint-png.png" 
                     alt="StockMint Logo"
                     onerror="this.onerror=null; this.src='https://via.placeholder.com/70/19BEBB/FFFFFF?text=SM'">
            </div>
            <div class="header-content">
                <h1>Excel Template Manager</h1>
                <p>Download template Excel untuk sistem StockMint</p>
            </div>
        </div>
        
        <div class="main-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <div>
                    <h2 style="color: var(--mint-dark);">Template Options</h2>
                    <p style="color: #666;">Pilih jenis template yang sesuai dengan kebutuhan Anda</p>
                </div>
                <button class="btn btn-back" onclick="window.location.href='dashboard.html'">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
            </div>
            
            <div class="template-options">
                <div class="option-card">
                    <h3><i class="fas fa-file-excel" style="color: #28a745;"></i> Template dengan Contoh Data</h3>
                    <p>Template ini sudah berisi contoh data untuk membantu Anda memahami struktur tabel.</p>
                    <ul>
                        <li>12 sheet lengkap dengan header</li>
                        <li>Data contoh untuk setiap sheet</li>
                        <li>Cocok untuk belajar dan testing</li>
                        <li>Format sudah sesuai dengan sistem</li>
                    </ul>
                    <button class="btn btn-primary" id="btnWithExamples">
                        <i class="fas fa-download"></i> Download with Examples
                    </button>
                </div>
                
                <div class="option-card">
                    <h3><i class="fas fa-file" style="color: #6c757d;"></i> Template Kosong</h3>
                    <p>Template kosong dengan struktur tabel siap diisi dengan data Anda.</p>
                    <ul>
                        <li>12 sheet dengan header saja</li>
                        <li>Tidak ada data contoh</li>
                        <li>Cocok untuk mulai dari awal</li>
                        <li>Format siap untuk data import</li>
                    </ul>
                    <button class="btn btn-secondary" id="btnEmptyTemplate">
                        <i class="fas fa-download"></i> Download Empty Template
                    </button>
                </div>
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-lightbulb"></i> Panduan Penggunaan Template</h3>
                <ol style="padding-left: 20px; margin-top: 10px;">
                    <li>Download template sesuai kebutuhan (dengan contoh atau kosong)</li>
                    <li>Buka file Excel di Microsoft Excel atau Google Sheets</li>
                    <li>Isi data Anda sesuai dengan struktur yang sudah disediakan</li>
                    <li><strong>Jangan hapus atau ubah nama sheet</strong></li>
                    <li><strong>Jangan ubah urutan atau nama header kolom</strong></li>
                    <li>Format tanggal harus: <code>YYYY-MM-DD HH:MM:SS</code></li>
                    <li>Gunakan ID yang konsisten antar tabel relasi</li>
                    <li>Simpan file dengan nama yang jelas, misal: <code>stockmint_data_[tanggal].xlsx</code></li>
                </ol>
            </div>
            
            <h3 style="color: var(--mint-dark); margin: 30px 0 15px 0;">Daftar Sheet dalam Template</h3>
            <div class="sheets-table">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th>Sheet Name</th>
                            <th>Description</th>
                            <th>Contoh Data</th>
                            <th>Kolom</th>
                        </tr>
                    </thead>
                    <tbody id="sheetsList">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div class="preview-section" id="previewSection" style="display: none;">
                <h3 id="previewTitle">Preview Data</h3>
                <div class="preview-table">
                    <table style="width: 100%;" id="previewTable">
                        <!-- Preview data akan diisi oleh JavaScript -->
                    </table>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 40px; padding-top: 25px; border-top: 1px solid #eee;">
                <p style="color: #666; margin-bottom: 15px;">Â© 2025 StockMint - Precision Inventory & Profit Tracking</p>
                <div style="display: flex; justify-content: center; gap: 15px;">
                    <button class="btn btn-primary" id="btnDownloadBoth">
                        <i class="fas fa-download"></i> Download Both Templates
                    </button>
                    <button class="btn btn-secondary" onclick="showInstructions()">
                        <i class="fas fa-question-circle"></i> View Detailed Instructions
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== DEFINISI SHEET TEMPLATE =====
        const templateSheets = [
            {
                name: "dim_Company",
                description: "Data perusahaan/perusahaan Anda",
                exampleRows: 1,
                columns: 18,
                headers: ["COMPANY_ID", "COMPANY_NAME", "STREET", "ZIP_CODE", "CITY", "COUNTRY", "ADDITIONAL_ADDRESS", "PHONE1", "PHONE2", "FAX", "EMAIL", "TAX_NO", "FISCAL_CODE", "WEBSITE", "LOGO_URL", "DEFAULT_WAREHOUSE_ID", "DEFAULT_CURRENCY", "DECIMAL_PLACES"],
                exampleData: [
                    [1, "PT. Maju Terus", "Jl. Pantai Indah Kapuk No. 88", "12345", "Tangerang", "Indonesia", "", "021 8888 9999", "", "", "majuterus@gmail,com", "", "", "", "", 1, "Rp.", 0]
                ]
            },
            {
                name: "dim_Suppliers",
                description: "Data supplier/pemasok",
                exampleRows: 3,
                columns: 16,
                headers: ["SUPPLIER_ID", "SUPPLIER_NAME", "STREET", "ZIP_CODE", "CITY", "COUNTRY", "ADDITIONAL_ADDRESS", "CONTACT_PERSON", "PHONE1", "PHONE2", "FAX", "EMAIL", "TAX_NO", "FISCAL_CODE", "WEBSITE", "ADDITIONAL_TEXT", "IS_ACTIVE"],
                exampleData: [
                    [1, "Pangan Jaya", "", "", "Bekasi", "Indonesia", "", "Joko", "081248109415", "", "", "", "", "", "", "", 1],
                    [2, "Subur Makmur", "", "", "Depok", "Indonesia", "", "Tini", "081534189381", "", "", "", "", "", "", "", 1],
                    [3, "Pasar Cuan", "", "", "Jakarta", "Indonesia", "", "Bambang", "081843135155", "", "", "", "", "", "", "", 1]
                ]
            },
            {
                name: "dim_Customers",
                description: "Data pelanggan",
                exampleRows: 7,
                columns: 18,
                headers: ["CUSTOMER_ID", "CUSTOMER_NAME", "STREET", "ZIP_CODE", "CITY", "COUNTRY", "ADDITIONAL_ADDRESS", "CONTACT_PERSON", "PHONE1", "PHONE2", "FAX", "EMAIL", "TAX_NO", "FISCAL_CODE", "WEBSITE", "CUSTOMER_TYPE", "CREDIT_LIMIT", "IS_ACTIVE"],
                exampleData: [
                    [1, "Adipati Dolken", "Jl. Backstreet 123", "15325", "Bogor", "Indonesia", "", "", "08889191919", "", "", "", "", "", "", "RETAIL", "", 1],
                    [2, "Shopee Customers", "", "", "", "Indonesia", "", "", "", "", "", "", "", "", "", "RETAIL", "", 1],
                    [3, "Tiktok Customers", "", "", "", "Indonesia", "", "", "", "", "", "", "", "", "", "RETAIL", "", 1],
                    [4, "Tokopedia Customers", "", "", "", "Indonesia", "", "", "", "", "", "", "", "", "", "RETAIL", "", 1],
                    [5, "Blibli Customers", "", "", "", "Indonesia", "", "", "", "", "", "", "", "", "", "RETAIL", "", 1],
                    [6, "Resto Pagi Siang", "", "", "Bandung", "Indonesia", "", "James", "08783113085", "", "", "", "", "", "", "WHOLESALE", "", 1],
                    [7, "Warung Emak", "", "", "Bekasi", "Indonesia", "", "Putri", "021-30517510", "", "", "", "", "", "", "RETAIL", 1000000, 1]
                ]
            },
            {
                name: "dim_Warehouses",
                description: "Data gudang/penyimpanan",
                exampleRows: 3,
                columns: 4,
                headers: ["STORAGE_ID", "STORAGE_NAME", "STORAGE_AREA", "IS_PRIMARY"],
                exampleData: [
                    [1, "GUDANG 1", "KAPUK", 1],
                    [2, "GUDANG 2", "KALIDERES", 0],
                    [3, "GUDANG 3", "KRAMAT JATI", 0]
                ]
            },
            {
                name: "dim_Categories",
                description: "Kategori produk",
                exampleRows: 3,
                columns: 2,
                headers: ["CATEGORY_ID", "CATEGORY_NAME"],
                exampleData: [
                    ["CAT-001", "Beverage"],
                    ["CAT-002", "Grocery"],
                    ["CAT-003", "Household"]
                ]
            },
            {
                name: "dim_Products",
                description: "Data produk/inventory",
                exampleRows: 4,
                columns: 9,
                headers: ["PRODUCT_ID", "PRODUCT_NAME", "DESCRIPTION", "CATEGORY_ID", "UNIT", "SIZE", "COLOR", "HAS_EXPIRY", "ARCHIVE"],
                exampleData: [
                    ["P001", "Kopi Arabica 250 gr", "", "CAT-001", "Pcs", "250 gr", "", 1, 0],
                    ["P002", "Gula Pasir 1 Kg", "Gula Putih", "CAT-002", "Pcs", "1 Kg", "Putih", 1, 0],
                    ["P003", "Sapu Pengki Set Warna Hijau", "", "CAT-003", "Set", "", "Hijau", 0, 0],
                    ["P004", "Sapu Pengki Set Warna Biru", "", "CAT-003", "Set", "", "Biru", 0, 0]
                ]
            },
            {
                name: "Product_Supplier_Warehouse",
                description: "Relasi produk-supplier-gudang",
                exampleRows: 4,
                columns: 6,
                headers: ["LINK_ID", "PRODUCT_ID", "SUPPLIER_ID", "WAREHOUSE ID", "IS PRIMARY SUPPLIER", "IS PRIMARY WAREHOUSE"],
                exampleData: [
                    ["LINK00001", "P001", 1, 1, 1, 1],
                    ["LINK00002", "P002", 2, 1, 1, 1],
                    ["LINK00003", "P003", 3, 2, 1, 1],
                    ["LINK00004", "P004", 3, 2, 1, 1]
                ]
            },
            {
                name: "Opening_Stock",
                description: "Stok awal produk",
                exampleRows: 4,
                columns: 4,
                headers: ["PRODUCT_ID", "WAREHOUSE_ID", "OPENING_QTY", "AS_OF_DATE"],
                exampleData: [
                    ["P001", 1, 100, "2025-12-15 00:00:00"],
                    ["P002", 1, 50, "2025-12-15 00:00:00"],
                    ["P003", 2, 12, "2025-12-15 00:00:00"],
                    ["P004", 2, 15, "2025-12-15 00:00:00"]
                ]
            },
            {
                name: "Purchase_Price",
                description: "Harga pembelian dari supplier",
                exampleRows: 10,
                columns: 7,
                headers: ["PURCHASE_PRICE_ID", "PRODUCT_ID", "SUPPLIER_ID", "EFFECTIVE_DATE", "END_DATE", "PURCHASE_PRICE", "MIN_PURCHASE_QTY"],
                exampleData: [
                    ["PCH00001", "P001", 1, "2025-12-01 00:00:00", null, 120000, 5],
                    ["PCH00002", "P001", 1, "2025-12-01 00:00:00", null, 100000, 25],
                    ["PCH00003", "P001", 1, "2025-12-01 00:00:00", null, 80000, 50],
                    ["PCH00004", "P002", 2, "2025-12-09 00:00:00", null, 13000, 1],
                    ["PCH00005", "P002", 2, "2025-12-09 00:00:00", null, 12500, 12],
                    ["PCH00006", "P002", 2, "2025-12-09 00:00:00", null, 12000, 24],
                    ["PCH00007", "P003", 3, "2025-12-12 00:00:00", null, 50000, 1],
                    ["PCH00008", "P003", 3, "2025-12-12 00:00:00", null, 40000, 5],
                    ["PCH00009", "P004", 3, "2025-12-12 00:00:00", null, 50000, 1],
                    ["PCH00010", "P004", 3, "2025-12-12 00:00:00", null, 40000, 5]
                ]
            },
            {
                name: "Sale_Price",
                description: "Harga jual ke customer",
                exampleRows: 9,
                columns: 8,
                headers: ["SALE_PRICE_ID", "PRODUCT_ID", "CHANNEL", "PRICE_TIER", "EFFECTIVE_DATE", "END_DATE", "SALE_PRICE", "MIN_QTY"],
                exampleData: [
                    ["SAL000001", "P001", "DEFAULT", "RETAIL", "2025-12-01 00:00:00", null, 150000, 1],
                    ["SAL000002", "P001", "DEFAULT", "GROSIR", "2025-12-01 00:00:00", null, 130000, 6],
                    ["SAL000003", "P001", "BLIBLI", "RETAIL", "2025-12-01 00:00:00", null, 130000, 1],
                    ["SAL000004", "P002", "DEFAULT", "RETAIL", "2025-12-01 00:00:00", null, 16000, 1],
                    ["SAL000005", "P002", "DEFAULT", "GROSIR", "2025-12-01 00:00:00", null, 15500, 5],
                    ["SAL000006", "P003", "DEFAULT", "RETAIL", "2025-12-01 00:00:00", null, 65000, 1],
                    ["SAL000007", "P003", "SHOPEE", "RETAIL", "2025-12-01 00:00:00", null, 62500, 1],
                    ["SAL000008", "P004", "DEFAULT", "RETAIL", "2025-12-01 00:00:00", null, 65000, 1],
                    ["SAL000009", "P004", "SHOPEE", "RETAIL", "2025-12-01 00:00:00", null, 62500, 1]
                ]
            },
            {
                name: "dim_Marketplace",
                description: "Data marketplace/platform",
                exampleRows: 4,
                columns: 4,
                headers: ["MARKETPLACE_ID", "MARKETPLACE_NAME", "WEBSITE", "IS_ACTIVE"],
                exampleData: [
                    [1, "Shopee", "shopee.co.id", 1],
                    [2, "Tokopedia", "tokopedia.com", 1],
                    [3, "TikTok Shop", "tiktok.com", 1],
                    [4, "Blibli", "blibli.com", 1]
                ]
            },
            {
                name: "marketplace_fee_components",
                description: "Komisi/fee marketplace",
                exampleRows: 12,
                columns: 13,
                headers: ["FEE_COMPONENT_ID", "MARKETPLACE_ID", "FEE_NAME", "FEE_TYPE", "CHARGE_TYPE", "CALCULATION_TYPE", "VALUE", "MAX_AMOUNT", "MIN_AMOUNT", "APPLIES_TO", "EFFECTIVE_DATE", "END_DATE", "IS_ACTIVE"],
                exampleData: [
                    [1, 1, "Biaya Administrasi", "STANDARD", "PER_ITEM", "PERCENTAGE", 0.08, null, null, "ALL_PRODUCTS", "2025-10-01 00:00:00", null, 1],
                    [2, 1, "Biaya Layanan", "STANDARD", "PER_ITEM", "PERCENTAGE", 0.06, 40000, null, "ALL_PRODUCTS", "2025-10-01 00:00:00", null, 1],
                    [3, 1, "Biaya Proses Pesanan", "STANDARD", "PER_INVOICE", "FIXED", 1250, null, null, "INVOICE", "2025-10-01 00:00:00", null, 1],
                    [4, 2, "Platform Commission", "STANDARD", "PER_ITEM", "PERCENTAGE", 0.08, null, null, "ALL_PRODUCTS", "2025-10-01 00:00:00", null, 1],
                    [5, 2, "Dynamic Commission", "STANDARD", "PER_ITEM", "PERCENTAGE", 0.06, 40000, null, "ALL_PRODUCTS", "2025-10-01 00:00:00", null, 1],
                    [6, 2, "Order Processing Fee", "STANDARD", "PER_INVOICE", "FIXED", 1250, null, null, "INVOICE", "2025-10-01 00:00:00", null, 1],
                    [7, 3, "Platform Commission", "STANDARD", "PER_ITEM", "PERCENTAGE", 0.08, null, null, "ALL_PRODUCTS", "2025-10-01 00:00:00", null, 1],
                    [8, 3, "Dynamic Commission", "STANDARD", "PER_ITEM", "PERCENTAGE", 0.06, 40000, null, "ALL_PRODUCTS", "2025-10-01 00:00:00", null, 1],
                    [9, 3, "Order Processing Fee", "STANDARD", "PER_INVOICE", "FIXED", 1250, null, null, "INVOICE", "2025-10-01 00:00:00", null, 1],
                    [10, 4, "Reguler Margin", "STANDARD", "PER_ITEM", "PERCENTAGE", 0.08, null, null, "ALL_PRODUCTS", "2025-10-01 00:00:00", null, 1],
                    [11, 4, "Biaya Layanan Pengiriman", "STANDARD", "PER_ITEM", "PERCENTAGE", 0.025, 10000, null, "ALL_PRODUCTS", "2025-10-01 00:00:00", null, 1],
                    [12, 4, "Rebate Reguler Margin", "CASHBACK", "PER_ITEM", "PERCENTAGE", 0.5, null, null, "ALL_PRODUCTS", "2025-10-01 00:00:00", null, 1]
                ]
            }
        ];

        // ===== FUNGSI UTAMA =====
        function downloadExcelTemplate(withExamples) {
            try {
                // Buat workbook baru
                const wb = XLSX.utils.book_new();
                
                // Tambahkan setiap sheet
                templateSheets.forEach(sheetDef => {
                    let data = [];
                    
                    // Tambahkan header
                    data.push(sheetDef.headers);
                    
                    // Tambahkan data contoh jika withExamples = true
                    if (withExamples && sheetDef.exampleData) {
                        sheetDef.exampleData.forEach(row => {
                            data.push(row);
                        });
                    } else {
                        // Tambahkan satu baris kosong untuk template kosong
                        const emptyRow = sheetDef.headers.map(() => "");
                        data.push(emptyRow);
                    }
                    
                    // Buat worksheet
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    
                    // Tambahkan ke workbook
                    XLSX.utils.book_append_sheet(wb, ws, sheetDef.name);
                });
                
                // Generate nama file
                const fileName = withExamples 
                    ? `StockMint_Template_With_Examples_${new Date().toISOString().slice(0,10)}.xlsx`
                    : `StockMint_Template_Empty_${new Date().toISOString().slice(0,10)}.xlsx`;
                
                // Download file
                XLSX.writeFile(wb, fileName);
                
                // Tampilkan pesan sukses
                alert(`âœ… Template berhasil diunduh!\nNama file: ${fileName}`);
                
            } catch (error) {
                console.error("Error generating Excel:", error);
                alert("âŒ Terjadi kesalahan saat membuat template. Silakan coba lagi.");
            }
        }

        // ===== TAMPILKAN DAFTAR SHEET =====
        function displaySheetsList() {
            const tbody = document.getElementById('sheetsList');
            tbody.innerHTML = '';
            
            templateSheets.forEach((sheet, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${sheet.name}</strong></td>
                    <td>${sheet.description}</td>
                    <td>${sheet.exampleRows} baris contoh</td>
                    <td>${sheet.columns} kolom</td>
                `;
                row.style.cursor = 'pointer';
                row.onclick = () => previewSheet(index);
                tbody.appendChild(row);
            });
        }

        // ===== PREVIEW SHEET =====
        function previewSheet(sheetIndex) {
            const sheet = templateSheets[sheetIndex];
            const previewSection = document.getElementById('previewSection');
            const previewTitle = document.getElementById('previewTitle');
            const previewTable = document.getElementById('previewTable');
            
            // Update title
            previewTitle.innerHTML = `<i class="fas fa-table"></i> Preview: ${sheet.name}`;
            
            // Buat tabel preview
            let tableHTML = '<thead><tr>';
            
            // Header
            sheet.headers.forEach(header => {
                tableHTML += `<th>${header}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';
            
            // Data contoh (maksimal 5 baris)
            const maxRows = Math.min(5, sheet.exampleData.length);
            for (let i = 0; i < maxRows; i++) {
                tableHTML += '<tr>';
                sheet.exampleData[i].forEach(cell => {
                    const cellValue = cell === null ? 'NULL' : cell;
                    tableHTML += `<td>${cellValue}</td>`;
                });
                tableHTML += '</tr>';
            }
            
            if (sheet.exampleData.length > 5) {
                tableHTML += `<tr><td colspan="${sheet.headers.length}" style="text-align: center; font-style: italic;">
                    ... dan ${sheet.exampleData.length - 5} baris lainnya
                </td></tr>`;
            }
            
            tableHTML += '</tbody>';
            previewTable.innerHTML = tableHTML;
            
            // Tampilkan preview section
            previewSection.style.display = 'block';
            
            // Scroll ke preview
            previewSection.scrollIntoView({ behavior: 'smooth' });
        }

        // ===== FUNGSI BANTUAN =====
        function showInstructions() {
            const instructions = `
ðŸ“‹ **PANDUAN LENGKAP PENGGUNAAN TEMPLATE STOCKMINT**

**1. STRUKTUR TEMPLATE:**
- Template terdiri dari 12 sheet yang saling terhubung
- Setiap sheet memiliki nama dan struktur kolom yang tetap
- Jangan ubah nama sheet atau header kolom

**2. TIPE DATA YANG DIREKOMENDASIKAN:**
- ID: Angka atau teks (P001, CAT-001)
- Tanggal: Format YYYY-MM-DD HH:MM:SS
- Angka: Tanpa pemisah ribuan (120000 bukan 120.000)
- Boolean: 1 (true) atau 0 (false)

**3. ATURAN PENTING:**
- ID harus unik dalam setiap tabel
- ID yang digunakan di tabel relasi harus ada di tabel induk
- Untuk nilai NULL/kosong, biarkan sel kosong
- Format mata uang: Rp. di depan (opsional)

**4. URUTAN PENGISIAN DATA (REKOMENDASI):**
1. dim_Company (data perusahaan)
2. dim_Warehouses (data gudang)
3. dim_Categories (kategori produk)
4. dim_Suppliers (data pemasok)
5. dim_Customers (data pelanggan)
6. dim_Products (data produk)
7. Product_Supplier_Warehouse (relasi)
8. Opening_Stock (stok awal)
9. Purchase_Price (harga beli)
10. Sale_Price (harga jual)
11. dim_Marketplace (marketplace)
12. marketplace_fee_components (fee)

**5. VALIDASI DATA:**
- Pastikan tidak ada ID duplikat
- Pastikan format tanggal benar
- Pastikan nilai angka valid (tidak negatif)
- Pastikan relasi antar tabel konsisten

**6. TROUBLESHOOTING:**
- Jika ada error saat upload, periksa format data
- Pastikan tidak ada karakter khusus di header
- Periksa konsistensi ID antar tabel
            `;
            
            alert(instructions);
        }

        // ===== DOWNLOAD BOTH TEMPLATES =====
        function downloadBothTemplates() {
            if (confirm("Unduh kedua template (dengan contoh dan kosong)?")) {
                // Download template dengan contoh
                setTimeout(() => {
                    downloadExcelTemplate(true);
                }, 500);
                
                // Download template kosong
                setTimeout(() => {
                    downloadExcelTemplate(false);
                }, 1500);
            }
        }

        // ===== INISIALISASI =====
        document.addEventListener('DOMContentLoaded', function() {
            // Tampilkan daftar sheet
            displaySheetsList();
            
            // Event listeners untuk tombol
            document.getElementById('btnWithExamples').addEventListener('click', function() {
                this.innerHTML = '<div class="loading"></div> Generating...';
                setTimeout(() => {
                    downloadExcelTemplate(true);
                    this.innerHTML = '<i class="fas fa-download"></i> Download with Examples';
                }, 500);
            });
            
            document.getElementById('btnEmptyTemplate').addEventListener('click', function() {
                this.innerHTML = '<div class="loading"></div> Generating...';
                setTimeout(() => {
                    downloadExcelTemplate(false);
                    this.innerHTML = '<i class="fas fa-download"></i> Download Empty Template';
                }, 500);
            });
            
            document.getElementById('btnDownloadBoth').addEventListener('click', downloadBothTemplates);
            
            // Cek jika ada parameter preview di URL
            const urlParams = new URLSearchParams(window.location.search);
            const previewSheet = urlParams.get('preview');
            if (previewSheet) {
                const sheetIndex = templateSheets.findIndex(s => s.name === previewSheet);
                if (sheetIndex !== -1) {
                    setTimeout(() => previewSheet(sheetIndex), 500);
                }
            }
        });
    </script>
</body>
</html>
